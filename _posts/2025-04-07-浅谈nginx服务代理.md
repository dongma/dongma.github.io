---
layout: post
title: 浅谈nginx服务代理
---
### `nginx`用`docker`安装
`nginx`服务安装，我是用`docker`安装的，`mac`系统编译`nginx`源码安装有点问题。
```shell
docker pull nginx # 从docker仓库拉取nginx镜像
# nginx目录挂载参考此文章，https://blog.csdn.net/baidu_21349635/article/details/102738972
docker run --name nginx-0807 -v /Users/madong/software/nginx/nginx.conf:/etc/nginx/nginx.conf \
-v /Users/madong/software/nginx/conf.d:/etc/nginx/conf.d \
-v /Users/madong/software/nginx/html:/usr/share/nginx/html \
-v /Users/madong/software/nginx/logs:/var/log/nginx -p 8080:80 -d nginx
# nginx服务验证，curl有返回html内容时，则表示nginx服务启动成功了； /etc/nginx存nginx配置、/usr/share/nginx存在html、/var/log/nginx/存放nginx的access_log
curl 'http://localhost:8080/'
```
`nginx`也支持热更新，当修改nginx配置后，可使用`nginx -s reload`使修改的配置生效，当`access.log`文件特别大时，可使用`nginx -s reopen`切割日志。
<!-- more -->
### `nginx`用源码安装
使用`nginx`源码包安装，用`docker nginx`有个明显的问题，那就是`nginx.conf`中`listen`不同端口时，容器内端口向外映射很麻烦，所以用源代码装。
步骤可分为以下`4`步：
1. 从`nginx`官网下载`stable version`源码，https://nginx.org/en/download.html；
2. 由于`nginx`有`c`的代码，所以需下载`pcre`、`openssl`和`zlib`工具，具体可参考文章：https://blog.csdn.net/a1004084857/article/details/128512612；
3. 解压`nginx zip`包，进入解压路径，对`nginx`进行配置，`--prefix`指定编译后的`nginx`二进制文件存放目录，`--with-pcre|zlib|openssl`分别为工具的解压逻辑；
```shell
./configure --prefix=/Users/madong/software/c_nginx_1.28.0 \
  --with-http_ssl_module \
  --with-pcre=./compile/pcre-8.45 \
  --with-zlib=./compile/zlib-1.3.1 \
  --with-openssl=./compile//openssl-3.0.7
```
4. 配置完成后，执行`make install`，则编译后的`nginx`就会出现在`/Users/madong/software/c_nginx_1.28.0`这个目录中；
